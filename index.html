<!DOCTYPE html>
<html lang="ja">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maitake Speech</title>
</head>

<body>
    <dev id="info">info</dev>
    <button id="startBtn">start</button>
    <button id="stopBtn">stop</button>
    <div id="result">result</div>
</body>

</html>

<script>
    const info = document.getElementById("info");
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const result = document.getElementById("result");

    SpeechRecognition = webkitSpeechRecognition || SpeechRecognition;

    if ('SpeechRecognition' in window) {
        info.innerText = "ブラウザは音声合成に対応しています。";
    } else {
        info.innerText = "ブラウザは音声合成に対応していません。";
    }

    const recognition = new SpeechRecognition();
    recognition.lang = 'ja-JP';
    recognition.interimResults = true;
    recognition.continuous = true;

    let finalTranscript = '';

    recognition.onresult = (event) => {
        let interimTranscript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
            let transcript = event.results[i][0].transcript;
            if (event.results[i].isFinal) {
                finalTranscript += transcript;
            } else {
                interimTranscript = transcript;
            }
        }
        result.innerHTML = finalTranscript + '<i style="color:#ddd;">' + interimTranscript + '</i>';
    }

    startBtn.onclick = () => {
        recognition.start();
    }
    stopBtn.onclick = () => {
        recognition.stop();
    }
</script>